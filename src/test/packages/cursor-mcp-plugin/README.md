# XHS Code Research MCP - ä»£ç ç ”ç©¶å·¥å…·

è¿™æ˜¯ä¸€ä¸ªæ”¯æŒå¤šè½®å¯¹è¯çš„å°çº¢ä¹¦ä»£ç ç ”ç©¶ MCP æ’ä»¶ï¼Œç”¨äºŽåˆ†æžä»£ç å®žä½“å¹¶ç”Ÿæˆç›¸å…³ä»£ç å»ºè®®ã€‚æ’ä»¶æä¾›äº¤äº’å¼çš„å®žä½“é€‰æ‹©å’Œç¡®è®¤æµç¨‹ï¼Œæœ€ç»ˆç”Ÿæˆä¼˜åŒ–çš„ä»£ç ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ðŸ” **æ™ºèƒ½å®žä½“æœç´¢**ï¼šæ ¹æ®éœ€æ±‚æè¿°æœç´¢ç›¸å…³çš„ä»£ç å®žä½“
- ðŸ”„ **å¤šè½®å¯¹è¯æ”¯æŒ**ï¼šäº¤äº’å¼çš„å®žä½“é€‰æ‹©å’Œç¡®è®¤æµç¨‹
- ðŸ“Š **å…³ç³»åˆ†æž**ï¼šåˆ†æžå®žä½“é—´çš„å¯¼å…¥ã€è°ƒç”¨ã€æ¨¡æ¿å’Œç›¸ä¼¼å…³ç³»
- âœ… **ç”¨æˆ·ç¡®è®¤æœºåˆ¶**ï¼šå…è®¸ç”¨æˆ·è°ƒæ•´å®žä½“é€‰æ‹©
- ðŸš€ **AI ä»£ç ç”Ÿæˆ**ï¼šæœ€ç»ˆè°ƒç”¨ AI Agent ç”Ÿæˆä¼˜åŒ–ä»£ç 

## å®‰è£…

```bash
npm install @xhs/code-research-mcp
```

## é…ç½®

### æ–¹å¼ä¸€ï¼šé¡¹ç›®çº§é…ç½®ï¼ˆæŽ¨èï¼‰

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.cursor/mcp.json` é…ç½®æ–‡ä»¶ï¼š

```json
{
  "mcpServers": {
    "code-research": {
      "command": "npx",
      "args": ["-y", "@xhs/code-research-mcp"],
      "env": {
        "CURSOR_WORKSPACE_PATH": "${workspaceFolder}",
        "MCP_RETURN_DIRECT": "false"
      }
    }
  }
}
```

### æ–¹å¼äºŒï¼šå…¨å±€é…ç½®

åœ¨ Cursor çš„ MCP Servers ä¸­é…ç½®ï¼š

```json
{
  "mcpServers": {
    "code-research": {
      "command": "npx",
      "args": ["-y", "@xhs/code-research-mcp"],
      "env": {
        "CURSOR_WORKSPACE_PATH": "${workspaceFolder}",
        "MCP_RETURN_DIRECT": "false"
      }
    }
  }
}
```

### ðŸ”§ é«˜çº§é…ç½®é€‰é¡¹

#### Return Direct æ¨¡å¼

é€šè¿‡è®¾ç½® `MCP_RETURN_DIRECT` çŽ¯å¢ƒå˜é‡æŽ§åˆ¶å·¥å…·è¾“å‡ºæ¨¡å¼ï¼š

- `MCP_RETURN_DIRECT=false` (é»˜è®¤): å·¥å…·ç»“æžœç»è¿‡AIä¼˜åŒ–åŽè¿”å›žï¼Œæ›´é€‚åˆæœ€ç»ˆç”¨æˆ·
- `MCP_RETURN_DIRECT=true`: å·¥å…·ç»“æžœç›´æŽ¥è¿”å›žï¼Œä¸ç»è¿‡AIå¤„ç†ï¼Œé€‚åˆè°ƒè¯•å’Œå¼€å‘

```json
{
  "mcpServers": {
    "code-research": {
      "command": "npx",
      "args": ["-y", "@xhs/code-research-mcp"],
      "env": {
        "CURSOR_WORKSPACE_PATH": "${workspaceFolder}",
        "MCP_RETURN_DIRECT": "true"
      }
    }
  }
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- âœ… å¼€å‘è°ƒè¯•ï¼šéœ€è¦æŸ¥çœ‹åŽŸå§‹æ•°æ®å’ŒæŠ€æœ¯ç»†èŠ‚
- âœ… æ€§èƒ½ä¼˜åŒ–ï¼šå‡å°‘AIå¤„ç†å»¶è¿Ÿ
- âœ… æ•°æ®åˆ†æžï¼šéœ€è¦ç²¾ç¡®çš„ç»“æž„åŒ–æ•°æ®
- âŒ æœ€ç»ˆç”¨æˆ·ï¼šå¸Œæœ›èŽ·å¾—å‹å¥½çš„è‡ªç„¶è¯­è¨€å“åº”

æ›´å¤šé…ç½®è¯¦æƒ…è¯·å‚è€ƒï¼š[Return Direct é…ç½®æŒ‡å—](./RETURN_DIRECT_CONFIG.md)

## ä½¿ç”¨æ–¹æ³•

### å‰ç½®æ¡ä»¶

1. é¡¹ç›®æ ¹ç›®å½•éœ€è¦å­˜åœ¨ `entities.enriched.json` æ–‡ä»¶
2. è¯¥æ–‡ä»¶åŒ…å«å·²è§£æžå’Œä¸°å¯Œçš„å®žä½“ä¿¡æ¯

### å®Œæ•´å·¥ä½œæµç¨‹

#### ç¬¬ä¸€æ­¥ï¼šå¼€å§‹åˆ†æž

```
å·¥å…·ï¼šstart-analysis
å‚æ•°ï¼š
- input: "æˆ‘éœ€è¦å®žçŽ°ç”¨æˆ·ç™»å½•åŠŸèƒ½"
- sessionId: "å¯é€‰ï¼Œç”¨äºŽå¤šè½®å¯¹è¯"
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
# ðŸ” å®žä½“åˆ†æžç»“æžœ

## éœ€æ±‚åˆ†æž
**ç”¨æˆ·éœ€æ±‚**: æˆ‘éœ€è¦å®žçŽ°ç”¨æˆ·ç™»å½•åŠŸèƒ½
**åˆ†æžç»“æžœ**: æ‰¾åˆ° 5 ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œ23 ä¸ªç›¸å…³å®žä½“
**åˆ†æžè€—æ—¶**: 0.45ç§’
**ä¼šè¯ID**: 1703123456789

## ðŸ“‹ æŽ¨èå®žä½“åˆ—è¡¨

### æ ¸å¿ƒç»„ä»¶ (æŒ‰ç›¸å…³åº¦æŽ’åº)
1. **UserService** (ç›¸å…³åº¦: 0.92)
   - ç±»åž‹: Service
   - æ–‡ä»¶: src/services/UserService.ts
   - æ‘˜è¦: ç”¨æˆ·ç›¸å…³ä¸šåŠ¡é€»è¾‘å¤„ç†

2. **AuthController** (ç›¸å…³åº¦: 0.87)
   - ç±»åž‹: Controller
   - æ–‡ä»¶: src/controllers/AuthController.ts
   - æ‘˜è¦: è®¤è¯ç›¸å…³çš„HTTPæŽ¥å£

### ç›¸å…³å®žä½“æ±‡æ€»
- å¯¼å…¥å…³ç³»: 8 ä¸ªå®žä½“
- è°ƒç”¨å…³ç³»: 12 ä¸ªå®žä½“
- æ¨¡æ¿å…³ç³»: 3 ä¸ªå®žä½“
- ç›¸ä¼¼æ ‡ç­¾: 15 ä¸ªå®žä½“

## ðŸŽ¯ ä¸‹ä¸€æ­¥æ“ä½œ

**é€‰é¡¹ 1**: å¦‚æžœæŽ¨èçš„å®žä½“åˆ—è¡¨æ»¡è¶³éœ€æ±‚ï¼Œè¯·ä½¿ç”¨ï¼š
å·¥å…·: confirm-entities
å‚æ•°: sessionId="1703123456789", action="confirm"

**é€‰é¡¹ 2**: å¦‚æžœéœ€è¦è°ƒæ•´å®žä½“é€‰æ‹©ï¼Œè¯·ä½¿ç”¨ï¼š
å·¥å…·: modify-entities
å‚æ•°: sessionId="1703123456789", entities="å®žä½“IDåˆ—è¡¨"

**é€‰é¡¹ 3**: å¦‚æžœéœ€è¦é‡æ–°æœç´¢ï¼Œè¯·ä½¿ç”¨ï¼š
å·¥å…·: start-analysis
å‚æ•°: input="æ–°çš„éœ€æ±‚æè¿°"
```

#### ç¬¬äºŒæ­¥ï¼ˆå¯é€‰ï¼‰ï¼šä¿®æ”¹å®žä½“é€‰æ‹©

```
å·¥å…·ï¼šmodify-entities
å‚æ•°ï¼š
- sessionId: "1703123456789"
- entities: "UserService,AuthController,JwtUtil"
- operation: "replace" | "add" | "remove"
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
# ðŸ“ å®žä½“é€‰æ‹©å·²æ›´æ–°

## æ“ä½œç»“æžœ
- æ“ä½œç±»åž‹: replace
- å½±å“å®žä½“: UserService, AuthController, JwtUtil
- å½“å‰é€‰ä¸­æ•°é‡: 3

## å½“å‰é€‰ä¸­çš„å®žä½“
1. **UserService** (Service) - src/services/UserService.ts
2. **AuthController** (Controller) - src/controllers/AuthController.ts
3. **JwtUtil** (Utility) - src/utils/JwtUtil.ts

## ðŸŽ¯ ä¸‹ä¸€æ­¥æ“ä½œ

**ç¡®è®¤å½“å‰é€‰æ‹©**:
å·¥å…·: confirm-entities
å‚æ•°: sessionId="1703123456789", action="confirm"

**ç»§ç»­ä¿®æ”¹**:
å·¥å…·: modify-entities
å‚æ•°: sessionId="1703123456789", entities="å®žä½“IDåˆ—è¡¨", operation="add/remove/replace"
```

#### ç¬¬ä¸‰æ­¥ï¼šç¡®è®¤å¹¶ç”Ÿæˆä»£ç 

```
å·¥å…·ï¼šconfirm-entities
å‚æ•°ï¼š
- sessionId: "1703123456789"
- action: "confirm"
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
# âœ… å®žä½“ç¡®è®¤å®Œæˆ

## ç¡®è®¤ä¿¡æ¯
- ä¼šè¯ID: 1703123456789
- ç”¨æˆ·éœ€æ±‚: æˆ‘éœ€è¦å®žçŽ°ç”¨æˆ·ç™»å½•åŠŸèƒ½
- é€‰ä¸­å®žä½“æ•°é‡: 15

## é€‰ä¸­çš„å®žä½“åˆ—è¡¨
1. **UserService** (Service) - src/services/UserService.ts
2. **AuthController** (Controller) - src/controllers/AuthController.ts
...

## ðŸš€ ä»£ç ç”Ÿæˆå‡†å¤‡å°±ç»ª

çŽ°åœ¨å°†ä½¿ç”¨ä»¥ä¸‹ä¸Šä¸‹æ–‡ç”Ÿæˆä»£ç ï¼š

### ç”¨æˆ·éœ€æ±‚
æˆ‘éœ€è¦å®žçŽ°ç”¨æˆ·ç™»å½•åŠŸèƒ½

### å®Œæ•´ä¸Šä¸‹æ–‡
# æœç´¢ç»“æžœ
[è¯¦ç»†çš„RAGæœç´¢ç»“æžœå’Œå®žä½“å…³ç³»åˆ†æž]

**ä¸‹ä¸€æ­¥**: ç³»ç»Ÿå°†è‡ªåŠ¨è°ƒç”¨ä»£ç ç”Ÿæˆ Agent æ¥å®žçŽ°æ‚¨çš„éœ€æ±‚ã€‚

âš¡ **æ­£åœ¨ç”Ÿæˆä»£ç ä¸­...**
```

## å·¥å…·è¯´æ˜Ž

### 1. start-analysis
- **åŠŸèƒ½**: å¼€å§‹ä»£ç å®žä½“åˆ†æžå¯¹è¯
- **å‚æ•°**: 
  - `input` (å¿…éœ€): ç”¨æˆ·éœ€æ±‚æè¿°
  - `sessionId` (å¯é€‰): ä¼šè¯ID
- **è¿”å›ž**: æŽ¨èçš„å®žä½“åˆ—è¡¨å’ŒåŽç»­æ“ä½œé€‰é¡¹

### 2. modify-entities
- **åŠŸèƒ½**: ä¿®æ”¹é€‰ä¸­çš„å®žä½“åˆ—è¡¨
- **å‚æ•°**: 
  - `sessionId` (å¿…éœ€): ä¼šè¯ID
  - `entities` (å¿…éœ€): å®žä½“IDåˆ—è¡¨ï¼Œé€—å·åˆ†éš”
  - `operation` (å¯é€‰): æ“ä½œç±»åž‹ (replace/add/remove)
- **è¿”å›ž**: æ›´æ–°åŽçš„å®žä½“åˆ—è¡¨

### 3. confirm-entities
- **åŠŸèƒ½**: ç¡®è®¤å®žä½“é€‰æ‹©å¹¶å¼€å§‹ä»£ç ç”Ÿæˆ
- **å‚æ•°**: 
  - `sessionId` (å¿…éœ€): ä¼šè¯ID
  - `action` (å¿…éœ€): æ“ä½œç±»åž‹ (confirm/modify)
- **è¿”å›ž**: ç¡®è®¤ä¿¡æ¯å’Œä»£ç ç”ŸæˆçŠ¶æ€

## å·¥ä½œæµç¨‹å›¾

```
1. ç”¨æˆ·è¾“å…¥éœ€æ±‚
   â†“
2. ç³»ç»Ÿåˆ†æžå¹¶æŽ¨èå®žä½“
   â†“
3. ç”¨æˆ·ç¡®è®¤æˆ–ä¿®æ”¹å®žä½“é€‰æ‹© â†â”€â”€â”
   â†“                        â”‚
4. å¦‚éœ€ä¿®æ”¹ï¼Œè¿”å›žæ­¥éª¤3 â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
5. ç¡®è®¤åŽç”Ÿæˆå®Œæ•´ä¸Šä¸‹æ–‡
   â†“
6. è°ƒç”¨AI Agentç”Ÿæˆä»£ç 
```

## ä¼˜åŠ¿ç‰¹æ€§

### ðŸŽ¯ ç²¾ç¡®æŽ§åˆ¶
ç”¨æˆ·å¯ä»¥ç²¾ç¡®æŽ§åˆ¶å“ªäº›å®žä½“å‚ä¸Žä»£ç ç”Ÿæˆï¼Œé¿å…ä¸ç›¸å…³çš„å¹²æ‰°

### ðŸ”„ äº¤äº’å¼ä½“éªŒ
æ”¯æŒå¤šè½®å¯¹è¯ï¼Œç”¨æˆ·å¯ä»¥éšæ—¶è°ƒæ•´å®žä½“é€‰æ‹©

### ðŸ“Š ä¸°å¯Œä¸Šä¸‹æ–‡
æä¾›å®Œæ•´çš„å®žä½“å…³ç³»åˆ†æžï¼Œç¡®ä¿AIç†è§£é¡¹ç›®ç»“æž„

### âš¡ é«˜æ•ˆç”Ÿæˆ
æœ€ç»ˆç”Ÿæˆçš„ä¸Šä¸‹æ–‡åŒ…å«äº†æ‰€æœ‰å¿…è¦ä¿¡æ¯ï¼Œæé«˜ä»£ç ç”Ÿæˆè´¨é‡

## å¼€å‘

```bash
# å®‰è£…ä¾èµ–
pnpm install

# æž„å»º
pnpm build

# å¯åŠ¨æœåŠ¡å™¨ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
pnpm start

# æµ‹è¯•
pnpm test

# ä»£ç æ£€æŸ¥
pnpm lint
```

## ä¾èµ–è¯´æ˜Ž

- `@modelcontextprotocol/sdk`: MCP SDKï¼Œç”¨äºŽæž„å»º MCP æœåŠ¡å™¨
- `@parser-agent/rag-inline-tool`: RAG å·¥å…·ï¼Œç”¨äºŽå®žä½“æœç´¢å’Œå…³ç³»åˆ†æž
- `zod`: å‚æ•°éªŒè¯åº“

## è´¡çŒ®

æ¬¢è¿Žæäº¤ Pull Request æˆ–åˆ›å»º Issueã€‚

## è®¸å¯è¯

MIT 

graph TD
    A[ç”¨æˆ·è¿è¡Œ cursor mcp analyze] --> B[åŠ è½½ MCP é…ç½®]
    B --> C[åˆå§‹åŒ–æ’ä»¶]
    C --> D[åˆ†æžä»£ç ç»“æž„]
    D --> E[DDD æ£€æµ‹]
    E --> F[å®žä½“ä¸°å¯ŒåŒ–]
    F --> G[ç”Ÿæˆä¿®æ”¹å»ºè®®]
    G --> H[ç”¨æˆ·ç¡®è®¤]
    H --> I[åº”ç”¨ä¿®æ”¹] 