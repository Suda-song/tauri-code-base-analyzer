# ğŸš€ æŒç»­ä¼šè¯ - å¿«é€Ÿå¼€å§‹

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- âœ… **ä¸€æ¬¡å¯åŠ¨ï¼ŒæŒç»­å¯¹è¯** - å¯åŠ¨å session ä¸€ç›´ä¿æŒå¼€å¯
- âœ… **è‡ªåŠ¨ç®¡ç† session** - SDK ä½¿ç”¨ AsyncIterable è‡ªåŠ¨ç»´æŠ¤ä¸Šä¸‹æ–‡
- âœ… **æ— éœ€ resume** - æ¯æ¬¡è¾“å…¥éƒ½åœ¨åŒä¸€ä¸ª session ä¸­
- âœ… **AI å®Œæ•´è®°å¿†** - è®°ä½æ‰€æœ‰å†å²å¯¹è¯

---

## ğŸ¯ å·¥ä½œåŸç†

```
å¯åŠ¨ Bridge:
  åˆ›å»º AsyncGenerator (æ¶ˆæ¯ç”Ÿæˆå™¨)
  â†“
  è°ƒç”¨ SDK: query({ prompt: generator })
  â†“
  SDK å¼€å§‹ç›‘å¬ generator

ä½ è¾“å…¥ç¬¬ 1 å¥è¯:
  "ä½ å¥½ï¼Œæˆ‘å«å°æ˜"
  â†“
  generator.yield(æ¶ˆæ¯)
  â†“
  SDK æ¥æ”¶ â†’ åˆ›å»º session-abc
  â†“
  AI å›å¤: "ä½ å¥½å°æ˜ï¼"
  â†“
  generator ç»§ç»­ç­‰å¾…...

ä½ è¾“å…¥ç¬¬ 2 å¥è¯:
  "æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ"
  â†“
  generator.yield(æ¶ˆæ¯)
  â†“
  SDK æ¥æ”¶ â†’ è‡ªåŠ¨å…³è”åˆ° session-abc
  â†“
  AI å›å¤: "ä½ å«å°æ˜ã€‚" âœ… è®°ä½äº†ï¼
  â†“
  generator ç»§ç»­ç­‰å¾…...

ä½ ç»§ç»­è¾“å…¥...
  è¿˜æ˜¯åœ¨åŒä¸€ä¸ª session-abc ä¸­
```

---

## ğŸš€ å¿«é€Ÿä½¿ç”¨

### æ­¥éª¤ 1: ç¼–è¯‘ Bridge

```bash
cd scripts
pnpm run build:continuous
```

### æ­¥éª¤ 2: ç›´æ¥è¿è¡Œ

```bash
node scripts/dist/continuous-session-bridge.js
```

### æ­¥éª¤ 3: å¼€å§‹å¯¹è¯

```
ğŸ’¬ å¼€å§‹å¯¹è¯ (è¾“å…¥ exit é€€å‡º)

ä½ å¥½ï¼Œæˆ‘å«å°æ˜
ğŸ“¤ [è½®æ¬¡ 1] å‘é€: "ä½ å¥½ï¼Œæˆ‘å«å°æ˜"

ğŸ†” ä¼šè¯å·²åˆ›å»º: f8a3c2d1...
ğŸ“¥ [è½®æ¬¡ 1] AI å›å¤:
ä½ å¥½å°æ˜ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚

æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ
ğŸ“¤ [è½®æ¬¡ 2] å‘é€: "æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ"

ğŸ“¥ [è½®æ¬¡ 2] AI å›å¤:
ä½ å«å°æ˜ã€‚

æˆ‘æ˜¯åšä»€ä¹ˆå·¥ä½œçš„ï¼Ÿ
ğŸ“¤ [è½®æ¬¡ 3] å‘é€: "æˆ‘æ˜¯åšä»€ä¹ˆå·¥ä½œçš„ï¼Ÿ"

ğŸ“¥ [è½®æ¬¡ 3] AI å›å¤:
æŠ±æ­‰ï¼Œä½ è¿˜æ²¡æœ‰å‘Šè¯‰æˆ‘ä½ æ˜¯åšä»€ä¹ˆå·¥ä½œçš„ã€‚
```

---

## ğŸ’¡ å¯ç”¨å‘½ä»¤

| å‘½ä»¤             | åŠŸèƒ½                           |
| ---------------- | ------------------------------ |
| æ­£å¸¸è¾“å…¥         | å‘é€æ¶ˆæ¯ï¼ˆè‡ªåŠ¨åœ¨åŒä¸€ sessionï¼‰ |
| `info`           | æŸ¥çœ‹ session ä¿¡æ¯              |
| `exit` æˆ– `quit` | é€€å‡º                           |

---

## ğŸ”‘ å…³é”®ä»£ç è§£æ

### 1. æ¶ˆæ¯ç”Ÿæˆå™¨

```typescript
async function* messageGenerator() {
  while (true) {
    const content = await getNextInput(); // ç­‰å¾…ç”¨æˆ·è¾“å…¥

    yield {
      type: "user",
      message: { role: "user", content },
      session_id: "", // SDK ä¼šè‡ªåŠ¨å…³è”
      parent_tool_use_id: null,
    };
  }
}
```

### 2. ä¼ é€’ç»™ SDK

```typescript
const response = query({
  prompt: messageGenerator(), // ğŸ‘ˆ ä¼ å…¥ç”Ÿæˆå™¨
  options: {
    cwd: workspace,
    maxTurns: 50,
  },
});
```

### 3. SDK è‡ªåŠ¨å¤„ç†

- SDK ä» generator è¯»å–æ¶ˆæ¯
- ç¬¬ä¸€æ¡æ¶ˆæ¯åˆ›å»º session
- åç»­æ¶ˆæ¯è‡ªåŠ¨å…³è”åˆ°åŒä¸€ session
- è‡ªåŠ¨ç»´æŠ¤å®Œæ•´å†å²

---

## ğŸ“Š å¯¹æ¯”ä¸‰ç§å®ç°

| æ–¹å¼                      | Session ç®¡ç†    | å¤æ‚åº¦ | AI è®°å¿†   | æ¨èåº¦     |
| ------------------------- | --------------- | ------ | --------- | ---------- |
| **æ–¹å¼ 1: ç®€å•æ¨¡å¼**      | æ¯æ¬¡æ–° session  | â­     | âŒ ä¸è®°å¾— | â­         |
| **æ–¹å¼ 2: Resume æ¨¡å¼**   | æ‰‹åŠ¨ä¼ é€’ resume | â­â­â­ | âœ… è®°å¾—   | â­â­â­     |
| **æ–¹å¼ 3: AsyncIterable** | SDK è‡ªåŠ¨ç®¡ç†    | â­â­   | âœ… è®°å¾—   | â­â­â­â­â­ |

---

## ğŸ“ ä¸ºä»€ä¹ˆæ¨èæ–¹å¼ 3

### ä¼˜åŠ¿

1. **æœ€ç¬¦åˆ SDK è®¾è®¡** - SDK åŸç”Ÿæ”¯æŒçš„æ¨¡å¼
2. **ä»£ç æœ€ç®€æ´** - æ— éœ€æ‰‹åŠ¨ç®¡ç† session_id
3. **çœŸæ­£çš„æŒç»­ä¼šè¯** - ä¸€æ¬¡è¿æ¥ï¼Œæ— é™è½®å¯¹è¯
4. **æ€§èƒ½æœ€å¥½** - æ— éœ€æ¯æ¬¡é‡æ–°å»ºç«‹è¿æ¥

### åŠ£åŠ¿

- éœ€è¦ç†è§£ AsyncGenerator æ¦‚å¿µ
- ä½†æˆ‘å·²ç»å¸®ä½ å°è£…å¥½äº†ï¼

---

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

### æµ‹è¯• AI è®°å¿†

```
ä½ å¥½ï¼Œæˆ‘å«å°æ˜ï¼Œæˆ‘æ˜¯ä¸€ä¸ªå‰ç«¯å·¥ç¨‹å¸ˆ

> AI: ä½ å¥½å°æ˜ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚ä½œä¸ºå‰ç«¯å·¥ç¨‹å¸ˆ...

æˆ‘åˆšæ‰è¯´æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ

> AI: ä½ å«å°æ˜ã€‚âœ…

æˆ‘æ˜¯åšä»€ä¹ˆå·¥ä½œçš„ï¼Ÿ

> AI: ä½ æ˜¯ä¸€ä¸ªå‰ç«¯å·¥ç¨‹å¸ˆã€‚âœ…

å¸®æˆ‘åˆ†æä¸€ä¸‹ /path/to/project

> AI: å¥½çš„å°æ˜ï¼Œæˆ‘æ¥å¸®ä½ åˆ†æ... âœ… è¿˜è®°å¾—åå­—ï¼
```

---

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

ç¼–è¾‘ `scripts/continuous-session-bridge.ts`:

```typescript
const options: Options = {
  cwd: "/your/workspace", // å·¥ä½œç›®å½•

  mcpServers: {
    // æ·»åŠ ä½ çš„ MCP å·¥å…·
    codebase: {
      type: "stdio",
      command: "/path/to/your/mcp-server",
    },
  },

  maxTurns: 50, // æœ€å¤§è½®æ•°
  permissionMode: "default", // æƒé™æ¨¡å¼

  // è‡ªå®šä¹‰ system prompt
  appendSystemPrompt: `
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä»£ç åˆ†æåŠ©æ‰‹ã€‚
ç”¨æˆ·æ˜¯é«˜çº§å·¥ç¨‹å¸ˆã€‚
  `,
};
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æŒç»­ä¼šè¯åŸç†æŒ‡å—](./CONTINUOUS_SESSION_GUIDE.md) - è¯¦ç»†åŸç†
- [æŒä¹…åŒ–å¯¹è¯å¯¹æ¯”](./PERSISTENT_CHAT_GUIDE.md) - Resume æ¨¡å¼
- [SDK æ‰©å±•æ¥å£](å·²åˆ›å»ºçš„ SDK åˆ†ææ–‡æ¡£) - Hooks ç­‰

---

## ğŸ‰ æ€»ç»“

**è¿™å°±æ˜¯ä½ æƒ³è¦çš„å®ç°æ–¹å¼ï¼**

- âœ… å¯åŠ¨ä¸€ä¸ª session
- âœ… Session ä¸€ç›´ä¿æŒå¼€å¯
- âœ… è¾“å…¥ä¸€å¥è¯ï¼Œåœ¨è¿™ä¸ª session ä¸­å¯¹è¯
- âœ… ç»§ç»­è¾“å…¥ï¼Œç»§ç»­åœ¨åŒä¸€ session ä¸­å¯¹è¯
- âœ… SDK è‡ªåŠ¨ç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„

ç«‹å³è¯•ç”¨ï¼š

```bash
cd scripts
pnpm run build:continuous
node dist/continuous-session-bridge.js
```

äº«å—ä½ çš„æŒç»­å¯¹è¯å§ï¼ğŸš€
