# ä»£ç å‘é‡åŒ–ä¸è¯­ä¹‰æœç´¢å®ç°è®¡åˆ’

## é¡¹ç›®æ¦‚è¿°

åŸºäº **OpenAI Embeddings API + Qdrant** çš„ä»£ç è¯­ä¹‰æœç´¢ç³»ç»Ÿï¼Œä¸º `tauri-code-base-analyzer` é¡¹ç›®æ·»åŠ æ™ºèƒ½ä»£ç æ£€ç´¢åŠŸèƒ½ã€‚

**æ ¸å¿ƒç›®æ ‡**ï¼š

- å°†ä»£ç åº“è½¬æ¢ä¸ºè¯­ä¹‰å‘é‡
- æ”¯æŒè‡ªç„¶è¯­è¨€æœç´¢ä»£ç 
- ç†è§£ä»£ç çš„åŠŸèƒ½å’Œæ„å›¾
- å®ç°è·¨æ–‡ä»¶çš„ä»£ç å…³è”

**æŠ€æœ¯æ ˆ**ï¼š

- **åç«¯**ï¼šRust + Tauri
- **å‘é‡åŒ–**ï¼šOpenAI Embeddings API (text-embedding-3-small)
- **å‘é‡æ•°æ®åº“**ï¼šQdrant
- **ä»£ç è§£æ**ï¼štree-sitterï¼ˆå·²æœ‰ï¼‰

---

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·ç•Œé¢ (å‰ç«¯)                           â”‚
â”‚                    è‡ªç„¶è¯­è¨€æœç´¢ + ç»“æœå±•ç¤º                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Tauri åç«¯ (Rust)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ ä»£ç æå–æ¨¡å—  â”‚â†’ â”‚ åˆ†å—å¢å¼ºæ¨¡å—  â”‚â†’ â”‚ å‘é‡åŒ–æ¨¡å—    â”‚          â”‚
â”‚  â”‚ (å·²å®Œæˆ 70%) â”‚  â”‚ (å¾…å®ç°)     â”‚  â”‚ (å¾…å®ç°)     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                             â”‚                                    â”‚
â”‚                             â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚             å‘é‡å­˜å‚¨ä¸æ£€ç´¢æ¨¡å—                      â”‚          â”‚
â”‚  â”‚              (Qdrant Client)                     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤–éƒ¨æœåŠ¡                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ OpenAI API       â”‚        â”‚ Qdrant Server    â”‚              â”‚
â”‚  â”‚ (Embeddings)     â”‚        â”‚ (æœ¬åœ°/äº‘ç«¯)       â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®æ–½é˜¶æ®µ

### ğŸ“¦ é˜¶æ®µ 0ï¼šç¯å¢ƒå‡†å¤‡ä¸ä¾èµ–å®‰è£… (1-2 å¤©)

#### ä»»åŠ¡æ¸…å•

- [ ] **å®‰è£… Qdrant**

  ```bash
  # æ–¹å¼ 1: Docker (æ¨è)
  docker run -p 6333:6333 -p 6334:6334 \
    -v $(pwd)/qdrant_storage:/qdrant/storage \
    qdrant/qdrant

  # æ–¹å¼ 2: æœ¬åœ°äºŒè¿›åˆ¶
  # https://qdrant.tech/documentation/quick-start/
  ```

- [ ] **æ³¨å†Œ OpenAI API**

  - è®¿é—®ï¼šhttps://platform.openai.com/api-keys
  - åˆ›å»º API Key
  - é…ç½®ç¯å¢ƒå˜é‡ï¼š`OPENAI_API_KEY`

- [ ] **æ·»åŠ  Rust ä¾èµ–**

  ```toml
  # src-tauri/Cargo.toml
  [dependencies]
  # ç°æœ‰ä¾èµ–
  tree-sitter = "0.22"
  tree-sitter-typescript = "0.21"
  tree-sitter-rust = "0.21"
  serde = { version = "1.0", features = ["derive"] }
  serde_json = "1.0"

  # æ–°å¢ä¾èµ–
  qdrant-client = "1.7"           # Qdrant å®¢æˆ·ç«¯
  reqwest = { version = "0.11", features = ["json"] }  # HTTP å®¢æˆ·ç«¯
  tokio = { version = "1", features = ["full"] }       # å¼‚æ­¥è¿è¡Œæ—¶
  anyhow = "1.0"                  # é”™è¯¯å¤„ç†
  regex = "1.10"                  # æ­£åˆ™è¡¨è¾¾å¼
  lazy_static = "1.4"             # å…¨å±€å˜é‡
  ```

- [ ] **é¡¹ç›®ç»“æ„è°ƒæ•´**
  ```
  src-tauri/src/
  â”œâ”€â”€ tool_execution/
  â”‚   â””â”€â”€ codebase/
  â”‚       â”œâ”€â”€ extractors/         (å·²æœ‰)
  â”‚       â”‚   â”œâ”€â”€ mod.rs
  â”‚       â”‚   â”œâ”€â”€ typescript.rs
  â”‚       â”‚   â”œâ”€â”€ vue.rs
  â”‚       â”‚   â””â”€â”€ type_utils.rs
  â”‚       â”œâ”€â”€ chunking.rs         (æ–°å¢)
  â”‚       â”œâ”€â”€ embeddings.rs       (æ–°å¢)
  â”‚       â”œâ”€â”€ vector_store.rs     (æ–°å¢)
  â”‚       â””â”€â”€ indexer.rs          (æ–°å¢)
  ```

#### éªŒæ”¶æ ‡å‡†

- âœ… Qdrant æœåŠ¡æ­£å¸¸è¿è¡Œï¼Œè®¿é—® http://localhost:6333/dashboard
- âœ… OpenAI API å¯†é’¥æœ‰æ•ˆï¼Œèƒ½æˆåŠŸè°ƒç”¨
- âœ… æ‰€æœ‰ä¾èµ–ç¼–è¯‘é€šè¿‡

---

### ğŸ”¨ é˜¶æ®µ 1ï¼šä»£ç åˆ†å—æ¨¡å— (2-3 å¤©)

#### ç›®æ ‡

å°†æå–çš„ `CodeEntity` è½¬æ¢ä¸ºåŒ…å«å®Œæ•´ä»£ç å†…å®¹å’Œä¸Šä¸‹æ–‡çš„ `CodeChunk`ã€‚

#### ä»»åŠ¡æ¸…å•

- [ ] **åˆ›å»º CodeChunk æ•°æ®ç»“æ„**

  ```rust
  // src-tauri/src/tool_execution/codebase/chunking.rs

  #[derive(Debug, Clone, Serialize, Deserialize)]
  pub struct CodeChunk {
      // åŸºç¡€ä¿¡æ¯
      pub id: String,
      pub entity_type: String,
      pub file: String,
      pub raw_name: String,
      pub loc: LocationInfo,

      // ä»£ç å†…å®¹
      pub code: String,

      // ä¸Šä¸‹æ–‡ä¿¡æ¯
      pub imports: Vec<String>,
      pub exports: Vec<String>,
      pub comments: Option<String>,

      // ç”¨äº embedding çš„æ ¼å¼åŒ–æ–‡æœ¬
      pub embedding_text: String,
  }
  ```

- [ ] **å®ç°ä»£ç æå–åŠŸèƒ½**

  - ä»æ–‡ä»¶ä¸­è¯»å–æŒ‡å®šè¡ŒèŒƒå›´çš„ä»£ç 
  - å¤„ç†è¾¹ç•Œæƒ…å†µï¼ˆæ–‡ä»¶å¼€å¤´/ç»“å°¾ï¼‰
  - ä¿ç•™ä»£ç ç¼©è¿›

- [ ] **å®ç°ä¸Šä¸‹æ–‡åˆ†æ**

  - æå– import è¯­å¥
  - æå– export è¯­å¥
  - æå–æ³¨é‡Šï¼ˆJSDocã€å•è¡Œã€å¤šè¡Œï¼‰
  - è¯†åˆ«ä¾èµ–å…³ç³»

- [ ] **å®ç° embedding æ–‡æœ¬æ ¼å¼åŒ–**

  - æ·»åŠ ç»“æ„åŒ–å…ƒæ•°æ®
  - åŒ…å«æ–‡ä»¶è·¯å¾„ã€ç±»å‹ã€åç§°
  - åŒ…å«å¯¼å…¥ä¾èµ–ä¿¡æ¯
  - ä¼˜åŒ– token ä½¿ç”¨

- [ ] **å•å…ƒæµ‹è¯•**

  ```rust
  #[test]
  fn test_chunk_creation() {
      // æµ‹è¯•ä» CodeEntity åˆ›å»º CodeChunk
  }

  #[test]
  fn test_import_extraction() {
      // æµ‹è¯•å¯¼å…¥è¯­å¥æå–
  }

  #[test]
  fn test_embedding_text_format() {
      // æµ‹è¯•æ ¼å¼åŒ–æ–‡æœ¬ç”Ÿæˆ
  }
  ```

#### å…³é”®å®ç°ç»†èŠ‚

**æ ¼å¼åŒ–æ¨¡æ¿**ï¼š

```
# File: src/components/Button.tsx
# Type: component
# Name: Button
# Location: Lines 10-25
# Imports: react, ./styles.css

## Code:
export function Button({ onClick, children }: ButtonProps) {
    return (
        <button onClick={onClick} className="btn">
            {children}
        </button>
    );
}
```

#### éªŒæ”¶æ ‡å‡†

- âœ… èƒ½ä» CodeEntity ç”Ÿæˆå®Œæ•´çš„ CodeChunk
- âœ… æ­£ç¡®æå–ä»£ç å†…å®¹å’Œä¸Šä¸‹æ–‡
- âœ… embedding_text æ ¼å¼ç¬¦åˆè¦æ±‚
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

### ğŸ§  é˜¶æ®µ 2ï¼šå‘é‡åŒ–æ¨¡å— (2-3 å¤©)

#### ç›®æ ‡

è°ƒç”¨ OpenAI API å°†ä»£ç å—è½¬æ¢ä¸ºå‘é‡ã€‚

#### ä»»åŠ¡æ¸…å•

- [ ] **åˆ›å»º EmbeddingsClient**

  ```rust
  // src-tauri/src/tool_execution/codebase/embeddings.rs

  pub struct EmbeddingsClient {
      api_key: String,
      client: reqwest::Client,
      model: String,
  }
  ```

- [ ] **å®ç°å•æ¬¡ embedding è¯·æ±‚**

  - æ„å»º API è¯·æ±‚
  - å¤„ç†å“åº”
  - é”™è¯¯å¤„ç†å’Œé‡è¯•

- [ ] **å®ç°æ‰¹é‡ embedding**

  - æ”¯æŒæ‰¹é‡è¯·æ±‚ï¼ˆæœ€å¤š 100 ä¸ª/æ‰¹æ¬¡ï¼‰
  - è¿›åº¦åé¦ˆ
  - é€Ÿç‡é™åˆ¶ï¼ˆé¿å…è§¦å‘é™æµï¼‰

- [ ] **å®ç°ç¼“å­˜æœºåˆ¶**

  - åŸºäºä»£ç å†…å®¹ hash çš„ç¼“å­˜
  - é¿å…é‡å¤è®¡ç®—
  - æŒä¹…åŒ–åˆ°ç£ç›˜

- [ ] **æˆæœ¬ä¼°ç®—ä¸ç›‘æ§**

  ```rust
  pub struct EmbeddingStats {
      pub total_tokens: usize,
      pub total_cost: f64,
      pub cache_hit_rate: f64,
  }
  ```

- [ ] **å•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯•**

#### å…³é”®å®ç°ç»†èŠ‚

**API è°ƒç”¨ç¤ºä¾‹**ï¼š

```rust
async fn call_openai_api(&self, texts: Vec<String>) -> Result<Vec<Vec<f32>>> {
    let request = json!({
        "model": "text-embedding-3-small",
        "input": texts,
        "encoding_format": "float"
    });

    let response = self.client
        .post("https://api.openai.com/v1/embeddings")
        .header("Authorization", format!("Bearer {}", self.api_key))
        .json(&request)
        .send()
        .await?;

    // å¤„ç†å“åº”...
}
```

**æ‰¹é‡å¤„ç†ç­–ç•¥**ï¼š

- æ¯æ‰¹ 100 ä¸ª chunk
- æ‰¹æ¬¡é—´å»¶è¿Ÿ 100ms
- å¤±è´¥è‡ªåŠ¨é‡è¯• 3 æ¬¡

#### æˆæœ¬ä¼°ç®—

- text-embedding-3-smallï¼š$0.00002 / 1K tokens
- å¹³å‡æ¯ä¸ª chunkï¼š~200 tokens
- 1000 ä¸ª chunkï¼š~$0.004ï¼ˆä¸åˆ° 1 åˆ†é’±ï¼‰

#### éªŒæ”¶æ ‡å‡†

- âœ… èƒ½æˆåŠŸè°ƒç”¨ OpenAI API
- âœ… æ‰¹é‡å¤„ç†æ­£å¸¸å·¥ä½œ
- âœ… ç¼“å­˜æœºåˆ¶æœ‰æ•ˆ
- âœ… é”™è¯¯å¤„ç†å®Œå–„

---

### ğŸ’¾ é˜¶æ®µ 3ï¼šå‘é‡å­˜å‚¨æ¨¡å— (2-3 å¤©)

#### ç›®æ ‡

å°†ä»£ç å—å’Œå‘é‡å­˜å‚¨åˆ° Qdrantï¼Œå®ç°é«˜æ•ˆæ£€ç´¢ã€‚

#### ä»»åŠ¡æ¸…å•

- [ ] **åˆ›å»º VectorStore å®¢æˆ·ç«¯**

  ```rust
  // src-tauri/src/tool_execution/codebase/vector_store.rs

  pub struct VectorStore {
      client: QdrantClient,
      config: VectorStoreConfig,
  }
  ```

- [ ] **å®ç°é›†åˆç®¡ç†**

  - åˆ›å»ºé›†åˆï¼ˆcollectionï¼‰
  - åˆ é™¤é›†åˆ
  - åˆ—å‡ºæ‰€æœ‰é›†åˆ

- [ ] **å®ç°æ•°æ®å†™å…¥**

  - æ‰¹é‡æ’å…¥å‘é‡
  - æ›´æ–°å‘é‡
  - åˆ é™¤å‘é‡

- [ ] **å®ç°å‘é‡æ£€ç´¢**

  - ç›¸ä¼¼åº¦æœç´¢
  - æ··åˆæœç´¢ï¼ˆå‘é‡ + è¿‡æ»¤æ¡ä»¶ï¼‰
  - åˆ†é¡µæ”¯æŒ

- [ ] **å®ç°å…ƒæ•°æ®ç®¡ç†**

  - å­˜å‚¨ä»£ç å—çš„å®Œæ•´ä¿¡æ¯
  - æ”¯æŒæŒ‰æ–‡ä»¶è·¯å¾„è¿‡æ»¤
  - æ”¯æŒæŒ‰ç±»å‹è¿‡æ»¤

- [ ] **å®ç°å·¥ä½œåŒºéš”ç¦»**
  - æ¯ä¸ª workspace ä¸€ä¸ªç‹¬ç«‹é›†åˆ
  - è·¨ workspace æœç´¢æ”¯æŒ

#### å…³é”®å®ç°ç»†èŠ‚

**é›†åˆé…ç½®**ï¼š

```rust
CreateCollection {
    collection_name: "workspace_my_project",
    vectors_config: VectorsConfig {
        size: 1536,              // text-embedding-3-small
        distance: Distance::Cosine,
        on_disk: true,           // å¤§æ•°æ®é›†æ—¶ä½¿ç”¨ç£ç›˜
    },
}
```

**Payload ç»“æ„**ï¼š

```json
{
  "id": "Component:Button",
  "entity_type": "component",
  "file": "src/components/Button.tsx",
  "raw_name": "Button",
  "code": "export function Button() {...}",
  "start_line": 10,
  "end_line": 25,
  "imports": ["react"],
  "workspace": "my_project"
}
```

#### éªŒæ”¶æ ‡å‡†

- âœ… èƒ½åˆ›å»ºå’Œç®¡ç†é›†åˆ
- âœ… èƒ½æ‰¹é‡æ’å…¥å‘é‡
- âœ… æœç´¢åŠŸèƒ½æ­£å¸¸
- âœ… å·¥ä½œåŒºéš”ç¦»æœ‰æ•ˆ

---

### ğŸ”„ é˜¶æ®µ 4ï¼šç´¢å¼•ç¼–æ’æ¨¡å— (2-3 å¤©)

#### ç›®æ ‡

å°†æå–ã€åˆ†å—ã€å‘é‡åŒ–ã€å­˜å‚¨ä¸²è”æˆå®Œæ•´çš„ç´¢å¼•æµç¨‹ã€‚

#### ä»»åŠ¡æ¸…å•

- [ ] **åˆ›å»º CodebaseIndexer**

  ```rust
  // src-tauri/src/tool_execution/codebase/indexer.rs

  pub struct CodebaseIndexer {
      ts_extractor: TypeScriptExtractor,
      vue_extractor: VueExtractor,
      embeddings_client: EmbeddingsClient,
      vector_store: VectorStore,
  }
  ```

- [ ] **å®ç°å®Œæ•´ç´¢å¼•æµç¨‹**

  ```rust
  pub async fn index_workspace(
      &mut self,
      workspace_path: &str,
      workspace_name: &str,
  ) -> Result<IndexStats>
  ```

- [ ] **å®ç°å¢é‡ç´¢å¼•**

  - æ£€æµ‹æ–‡ä»¶å˜åŒ–
  - åªæ›´æ–°ä¿®æ”¹çš„æ–‡ä»¶
  - åˆ é™¤ä¸å­˜åœ¨æ–‡ä»¶çš„å‘é‡

- [ ] **å®ç°è¿›åº¦åé¦ˆ**

  - å®æ—¶è¿›åº¦æ›´æ–°
  - é¢„è®¡å‰©ä½™æ—¶é—´
  - é”™è¯¯æŠ¥å‘Š

- [ ] **å®ç°ç´¢å¼•ç»Ÿè®¡**

  ```rust
  pub struct IndexStats {
      pub total_files: usize,
      pub total_entities: usize,
      pub total_chunks: usize,
      pub total_vectors: usize,
      pub total_cost: f64,
      pub duration: Duration,
  }
  ```

- [ ] **å®ç°é…ç½®ç®¡ç†**
  - æ”¯æŒ .cursorignore
  - å¯é…ç½®çš„æ–‡ä»¶ç±»å‹
  - å¯é…ç½®çš„æœ€å¤§æ–‡ä»¶å¤§å°

#### å·¥ä½œæµç¨‹

```rust
async fn index_workspace(&mut self, path: &str, name: &str) -> Result<IndexStats> {
    // 1. æ‰«ææ–‡ä»¶
    let files = self.scan_files(path)?;
    println!("ğŸ“ å‘ç° {} ä¸ªæ–‡ä»¶", files.len());

    // 2. æå–å®ä½“
    let entities = self.extract_entities(&files)?;
    println!("ğŸ” æå– {} ä¸ªå®ä½“", entities.len());

    // 3. åˆ›å»ºä»£ç å—
    let chunks = self.create_chunks(entities, path)?;
    println!("ğŸ“¦ åˆ›å»º {} ä¸ªä»£ç å—", chunks.len());

    // 4. å‘é‡åŒ–
    let embeddings = self.embeddings_client.embed_chunks(&chunks).await?;
    println!("ğŸ§  ç”Ÿæˆ {} ä¸ªå‘é‡", embeddings.len());

    // 5. å­˜å‚¨
    self.vector_store.upsert_chunks(name, &chunks, embeddings).await?;
    println!("ğŸ’¾ å­˜å‚¨å®Œæˆ");

    Ok(stats)
}
```

#### éªŒæ”¶æ ‡å‡†

- âœ… å®Œæ•´æµç¨‹èƒ½è·‘é€š
- âœ… è¿›åº¦åé¦ˆå‡†ç¡®
- âœ… å¢é‡ç´¢å¼•æœ‰æ•ˆ
- âœ… é”™è¯¯å¤„ç†å®Œå–„

---

### ğŸ” é˜¶æ®µ 5ï¼šæœç´¢æŸ¥è¯¢æ¨¡å— (2-3 å¤©)

#### ç›®æ ‡

å®ç°è‡ªç„¶è¯­è¨€æœç´¢ä»£ç çš„åŠŸèƒ½ã€‚

#### ä»»åŠ¡æ¸…å•

- [ ] **åˆ›å»º CodeSearcher**

  ```rust
  pub struct CodeSearcher {
      embeddings_client: EmbeddingsClient,
      vector_store: VectorStore,
  }
  ```

- [ ] **å®ç°åŸºç¡€æœç´¢**

  ```rust
  pub async fn search(
      &self,
      workspace: &str,
      query: &str,
      limit: usize,
  ) -> Result<Vec<SearchResult>>
  ```

- [ ] **å®ç°é«˜çº§æœç´¢**

  - è¿‡æ»¤å™¨æ”¯æŒï¼ˆæŒ‰ç±»å‹ã€æ–‡ä»¶è·¯å¾„ï¼‰
  - ç›¸å…³åº¦è¯„åˆ†
  - ç»“æœå»é‡

- [ ] **å®ç°æœç´¢ç»“æœæ’åº**

  - æŒ‰ç›¸ä¼¼åº¦
  - æŒ‰æ–‡ä»¶å
  - æŒ‰ç±»å‹

- [ ] **å®ç°æœç´¢ä¼˜åŒ–**
  - æŸ¥è¯¢æ‰©å±•ï¼ˆåŒä¹‰è¯ï¼‰
  - ç»“æœé‡æ’åº
  - ä¸Šä¸‹æ–‡å¢å¼º

#### æœç´¢ç»“æœç»“æ„

```rust
#[derive(Debug, Serialize)]
pub struct SearchResult {
    pub chunk: CodeChunk,
    pub score: f32,              // ç›¸ä¼¼åº¦åˆ†æ•°
    pub highlights: Vec<String>,  // é«˜äº®ç‰‡æ®µ
    pub context: Option<String>,  // å‘¨å›´ä»£ç ä¸Šä¸‹æ–‡
}
```

#### éªŒæ”¶æ ‡å‡†

- âœ… èƒ½æ‰§è¡Œè‡ªç„¶è¯­è¨€æœç´¢
- âœ… ç»“æœç›¸å…³æ€§é«˜
- âœ… æ€§èƒ½å¯æ¥å—ï¼ˆ<500msï¼‰

---

### ğŸ–¥ï¸ é˜¶æ®µ 6ï¼šTauri å‘½ä»¤é›†æˆ (2 å¤©)

#### ç›®æ ‡

å°†ç´¢å¼•å’Œæœç´¢åŠŸèƒ½æš´éœ²ä¸º Tauri å‘½ä»¤ï¼Œä¾›å‰ç«¯è°ƒç”¨ã€‚

#### ä»»åŠ¡æ¸…å•

- [ ] **å®šä¹‰ Tauri Commands**

  ```rust
  #[tauri::command]
  async fn index_workspace(
      workspace_path: String,
      workspace_name: String,
  ) -> Result<IndexStats, String>

  #[tauri::command]
  async fn search_code(
      workspace: String,
      query: String,
      limit: usize,
  ) -> Result<Vec<SearchResult>, String>

  #[tauri::command]
  async fn get_index_status(
      workspace: String,
  ) -> Result<IndexStatus, String>
  ```

- [ ] **å®ç°çŠ¶æ€ç®¡ç†**

  - ç´¢å¼•è¿›åº¦è¿½è¸ª
  - é”™è¯¯çŠ¶æ€
  - é…ç½®ç®¡ç†

- [ ] **å®ç°äº‹ä»¶æ¨é€**
  ```rust
  // å‘å‰ç«¯æ¨é€ç´¢å¼•è¿›åº¦
  app.emit_all("indexing-progress", IndexProgress {
      current: 100,
      total: 500,
      message: "æ­£åœ¨ç´¢å¼•æ–‡ä»¶...",
  })?;
  ```

#### éªŒæ”¶æ ‡å‡†

- âœ… å‰ç«¯èƒ½è°ƒç”¨æ‰€æœ‰å‘½ä»¤
- âœ… è¿›åº¦å®æ—¶æ›´æ–°
- âœ… é”™è¯¯æ­£ç¡®ä¼ é€’

---

### ğŸ¨ é˜¶æ®µ 7ï¼šå‰ç«¯ç•Œé¢ (3-4 å¤©)

#### ç›®æ ‡

æ„å»ºç”¨æˆ·å‹å¥½çš„æœç´¢ç•Œé¢ã€‚

#### ä»»åŠ¡æ¸…å•

- [ ] **æœç´¢è¾“å…¥ç»„ä»¶**

  - è‡ªç„¶è¯­è¨€è¾“å…¥æ¡†
  - æœç´¢å†å²
  - å¿«æ·é”®æ”¯æŒ

- [ ] **æœç´¢ç»“æœå±•ç¤º**

  - ä»£ç é«˜äº®
  - ç›¸å…³åº¦æ˜¾ç¤º
  - æ–‡ä»¶è·¯å¾„è·³è½¬

- [ ] **ç´¢å¼•ç®¡ç†ç•Œé¢**

  - ç´¢å¼•è¿›åº¦æ¡
  - ç´¢å¼•ç»Ÿè®¡
  - é‡æ–°ç´¢å¼•æŒ‰é’®

- [ ] **è®¾ç½®é¡µé¢**
  - OpenAI API Key é…ç½®
  - Qdrant æœåŠ¡å™¨é…ç½®
  - ç´¢å¼•é€‰é¡¹é…ç½®

#### UI è®¾è®¡å‚è€ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”  æœç´¢ä»£ç åº“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å¦‚ä½•å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½ï¼Ÿ                  [æœç´¢]  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                      â”‚
â”‚  ğŸ“Š æœç´¢ç»“æœ (æ‰¾åˆ° 5 ä¸ªç›¸å…³ä»£ç )                      â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“„ src/auth/login.ts                 95%    â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚   â”‚
â”‚  â”‚ export async function login(credentials) {  â”‚   â”‚
â”‚  â”‚     const response = await api.post(...)    â”‚   â”‚
â”‚  â”‚ }                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ...                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### éªŒæ”¶æ ‡å‡†

- âœ… ç•Œé¢ç¾è§‚æ˜“ç”¨
- âœ… æœç´¢å“åº”å¿«é€Ÿ
- âœ… ä»£ç é«˜äº®æ­£ç¡®

---

### âœ… é˜¶æ®µ 8ï¼šæµ‹è¯•ä¸ä¼˜åŒ– (2-3 å¤©)

#### æµ‹è¯•æ¸…å•

- [ ] **å•å…ƒæµ‹è¯•**

  - æ¯ä¸ªæ¨¡å—è¦†ç›–ç‡ > 80%

- [ ] **é›†æˆæµ‹è¯•**

  - å®Œæ•´ç´¢å¼•æµç¨‹
  - æœç´¢å‡†ç¡®æ€§æµ‹è¯•

- [ ] **æ€§èƒ½æµ‹è¯•**

  - ç´¢å¼•é€Ÿåº¦ï¼šç›®æ ‡ 100 æ–‡ä»¶/åˆ†é’Ÿ
  - æœç´¢å»¶è¿Ÿï¼šç›®æ ‡ < 500ms
  - å†…å­˜å ç”¨ï¼šç›®æ ‡ < 500MB

- [ ] **ç”¨æˆ·æµ‹è¯•**
  - å®é™…ä»£ç åº“æµ‹è¯•
  - æ”¶é›†åé¦ˆ

#### ä¼˜åŒ–æ–¹å‘

- [ ] **æ€§èƒ½ä¼˜åŒ–**

  - å¹¶è¡Œå¤„ç†
  - ç¼“å­˜ä¼˜åŒ–
  - æ‰¹é‡æ“ä½œ

- [ ] **å‡†ç¡®æ€§ä¼˜åŒ–**

  - è°ƒæ•´ embedding æ ¼å¼
  - ä¼˜åŒ–æœç´¢ç®—æ³•
  - æ·»åŠ æ›´å¤šä¸Šä¸‹æ–‡

- [ ] **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
  - åŠ è½½çŠ¶æ€ä¼˜åŒ–
  - é”™è¯¯æç¤ºä¼˜åŒ–
  - å¿«æ·é”®æ”¯æŒ

#### éªŒæ”¶æ ‡å‡†

- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… æ€§èƒ½è¾¾æ ‡
- âœ… ç”¨æˆ·åé¦ˆè‰¯å¥½

---

## æ—¶é—´è§„åˆ’

| é˜¶æ®µ | ä»»åŠ¡         | é¢„è®¡æ—¶é—´ | ä¼˜å…ˆçº§  |
| ---- | ------------ | -------- | ------- |
| 0    | ç¯å¢ƒå‡†å¤‡     | 1-2 å¤©   | ğŸ”´ æœ€é«˜ |
| 1    | ä»£ç åˆ†å—æ¨¡å— | 2-3 å¤©   | ğŸ”´ æœ€é«˜ |
| 2    | å‘é‡åŒ–æ¨¡å—   | 2-3 å¤©   | ğŸ”´ æœ€é«˜ |
| 3    | å‘é‡å­˜å‚¨æ¨¡å— | 2-3 å¤©   | ğŸ”´ æœ€é«˜ |
| 4    | ç´¢å¼•ç¼–æ’æ¨¡å— | 2-3 å¤©   | ğŸŸ¡ é«˜   |
| 5    | æœç´¢æŸ¥è¯¢æ¨¡å— | 2-3 å¤©   | ğŸŸ¡ é«˜   |
| 6    | Tauri é›†æˆ   | 2 å¤©     | ğŸŸ¡ é«˜   |
| 7    | å‰ç«¯ç•Œé¢     | 3-4 å¤©   | ğŸŸ¢ ä¸­   |
| 8    | æµ‹è¯•ä¼˜åŒ–     | 2-3 å¤©   | ğŸŸ¢ ä¸­   |

**æ€»è®¡**ï¼šçº¦ 3-4 å‘¨

---

## æˆæœ¬é¢„ç®—

### OpenAI API æˆæœ¬

**æ¨¡å‹**ï¼štext-embedding-3-small
**å®šä»·**ï¼š$0.00002 / 1K tokens

**ç¤ºä¾‹è®¡ç®—**ï¼ˆä¸­ç­‰è§„æ¨¡é¡¹ç›®ï¼‰ï¼š

- ä»£ç åº“ï¼š1000 ä¸ªæ–‡ä»¶
- å¹³å‡æå–ï¼š5 ä¸ªå®ä½“/æ–‡ä»¶ = 5000 ä¸ªå®ä½“
- å¹³å‡ä»£ç å—å¤§å°ï¼š200 tokens
- æ€» tokensï¼š5000 Ã— 200 = 1,000,000 tokens
- **æ€»æˆæœ¬**ï¼š$0.02ï¼ˆ2 åˆ†é’±ï¼‰

**æœˆåº¦æˆæœ¬ä¼°ç®—**ï¼š

- åˆæ¬¡ç´¢å¼•ï¼š$0.02
- å¢é‡æ›´æ–°ï¼ˆæ¯å¤© 10%ï¼‰ï¼š$0.002/å¤© Ã— 30 = $0.06/æœˆ
- **æœˆåº¦æ€»è®¡**ï¼š< $0.1ï¼ˆçº¦ 0.7 å…ƒäººæ°‘å¸ï¼‰

### Qdrant æˆæœ¬

- **æœ¬åœ°éƒ¨ç½²**ï¼š0 å…ƒï¼ˆæ¨èå¼€å‘é˜¶æ®µï¼‰
- **Qdrant Cloud å…è´¹å±‚**ï¼š1GB å­˜å‚¨ï¼Œè¶³å¤Ÿå°å‹é¡¹ç›®
- **ä»˜è´¹ç‰ˆ**ï¼š$25/æœˆèµ·ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

### æ€»æˆæœ¬

- **å¼€å‘é˜¶æ®µ**ï¼š~$0.5/æœˆ
- **ç”Ÿäº§ç¯å¢ƒ**ï¼š$25-50/æœˆï¼ˆå¦‚ä½¿ç”¨äº‘æœåŠ¡ï¼‰

---

## æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### éš¾ç‚¹ 1ï¼šå¤§å‹ä»£ç åº“ç´¢å¼•é€Ÿåº¦æ…¢

**è§£å†³æ–¹æ¡ˆ**ï¼š

- å¹¶è¡Œå¤„ç†å¤šä¸ªæ–‡ä»¶
- æ‰¹é‡è°ƒç”¨ OpenAI API
- ä½¿ç”¨ç¼“å­˜é¿å…é‡å¤è®¡ç®—
- å¢é‡ç´¢å¼•

### éš¾ç‚¹ 2ï¼šæœç´¢ç»“æœä¸å¤Ÿå‡†ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š

- ä¼˜åŒ– embedding æ–‡æœ¬æ ¼å¼
- æ·»åŠ æ›´å¤šä¸Šä¸‹æ–‡ä¿¡æ¯
- å®ç°æ··åˆæœç´¢ï¼ˆå‘é‡ + å…³é”®å­—ï¼‰
- ç»“æœé‡æ’åº

### éš¾ç‚¹ 3ï¼šå†…å­˜å ç”¨è¿‡é«˜

**è§£å†³æ–¹æ¡ˆ**ï¼š

- Qdrant ä½¿ç”¨ç£ç›˜å­˜å‚¨
- æµå¼å¤„ç†å¤§æ–‡ä»¶
- åŠæ—¶é‡Šæ”¾ä¸´æ—¶æ•°æ®
- åˆ†æ‰¹å¤„ç†

### éš¾ç‚¹ 4ï¼šAPI è°ƒç”¨å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š

- å®ç°é‡è¯•æœºåˆ¶
- æ·»åŠ é€Ÿç‡é™åˆ¶
- æœ¬åœ°ç¼“å­˜
- é™çº§æ–¹æ¡ˆï¼ˆä½¿ç”¨ç®€å•æ–‡æœ¬åŒ¹é…ï¼‰

---

## é‡Œç¨‹ç¢‘

### M1ï¼šæ ¸å¿ƒåŠŸèƒ½å¯ç”¨ï¼ˆ2 å‘¨åï¼‰

- âœ… èƒ½ç´¢å¼•ä»£ç åº“
- âœ… èƒ½è¿›è¡ŒåŸºç¡€æœç´¢
- âœ… æœç´¢ç»“æœåŸºæœ¬å‡†ç¡®

### M2ï¼šåŠŸèƒ½å®Œæ•´ï¼ˆ3 å‘¨åï¼‰

- âœ… å¢é‡ç´¢å¼•
- âœ… é«˜çº§æœç´¢
- âœ… å‰ç«¯ç•Œé¢å®Œå–„

### M3ï¼šç”Ÿäº§å°±ç»ªï¼ˆ4 å‘¨åï¼‰

- âœ… æµ‹è¯•è¦†ç›–å……åˆ†
- âœ… æ€§èƒ½ä¼˜åŒ–å®Œæˆ
- âœ… æ–‡æ¡£é½å…¨

---

## é…ç½®æ–‡ä»¶ç¤ºä¾‹

### .env

```bash
OPENAI_API_KEY=sk-...
QDRANT_URL=http://localhost:6333
```

### config.json

```json
{
  "embedding": {
    "model": "text-embedding-3-small",
    "batch_size": 100,
    "cache_enabled": true
  },
  "qdrant": {
    "url": "http://localhost:6333",
    "collection_prefix": "workspace_"
  },
  "indexing": {
    "max_file_size_mb": 1,
    "ignore_patterns": ["**/node_modules/**", "**/dist/**", "**/*.min.js"],
    "supported_extensions": [".ts", ".tsx", ".js", ".jsx", ".vue"]
  }
}
```

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… **ç«‹å³å¼€å§‹**ï¼šé˜¶æ®µ 0 - ç¯å¢ƒå‡†å¤‡
2. ğŸ“… **æœ¬å‘¨ç›®æ ‡**ï¼šå®Œæˆé˜¶æ®µ 1 - ä»£ç åˆ†å—æ¨¡å—
3. ğŸ“… **ä¸‹å‘¨ç›®æ ‡**ï¼šå®Œæˆé˜¶æ®µ 2-3 - å‘é‡åŒ–ä¸å­˜å‚¨

---

## å‚è€ƒèµ„æº

### æ–‡æ¡£

- [OpenAI Embeddings API](https://platform.openai.com/docs/guides/embeddings)
- [Qdrant Documentation](https://qdrant.tech/documentation/)
- [tree-sitter Documentation](https://tree-sitter.github.io/tree-sitter/)

### ç¤ºä¾‹é¡¹ç›®

- [code-search-example](https://github.com/openai/openai-cookbook/blob/main/examples/Code_search.ipynb)
- [qdrant-rust-examples](https://github.com/qdrant/qdrant-client/tree/master/examples)

---

**æœ€åæ›´æ–°**ï¼š2025-10-01
**è´Ÿè´£äºº**ï¼šå¼€å‘å›¢é˜Ÿ
**çŠ¶æ€**ï¼šå¾…å¼€å§‹
